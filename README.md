# Социальная платформа API

REST API для социальной платформы с авторизацией пользователей и постами.

## Технологии

- **Backend:** Node.js + Express.js + TypeScript
- **База данных:** MariaDB + TypeORM
- **Аутентификация:** JWT + bcrypt
- **Безопасность:** CORS, Helmet
- **Тестирование:** Jest + Supertest

## Архитектура

- **Контроллеры** - обработка HTTP запросов
- **Сущности** - User и Post с индексами для производительности
- **Middleware** - авторизация по JWT токенам
- **Валидация** - проверка входных данных
- **Связи** - User ↔ Posts (один-ко-многим)

## Установка и Запуск

### Предварительные требования

Убедитесь, что у вас установлены:

- **Docker** (версия 20.0 или выше)
- **Docker Compose** (версия 2.0 или выше)
- **Node.js** (версия 20 или выше) - для разработки без Docker
- **npm** - для установки зависимостей

### Установка Docker

#### Ubuntu/Debian:

```bash
# Обновление пакетов
sudo apt-get update

# Установка Docker
sudo apt-get install -y docker.io docker-compose-plugin

# Добавление пользователя в группу docker
sudo usermod -aG docker $USER

# Перезапуск сессии (выйдите и войдите в систему)
```

#### Windows/macOS:

Скачайте и установите [Docker Desktop](https://www.docker.com/products/docker-desktop/)

### КОГДА ДОКЕР УСТАНОВЛЕН - Полная установка проекта

#### 1. Клонирование репозитория

```bash
git clone <repository-url>
cd test-social-platform
```

#### 2. Установка зависимостей Node.js

```bash
npm install
```

**Важно:** При первой установке зависимостей процесс компиляции нативных модулей (gcc & g++) может занять длительное время (3-10 минут). Это нормально - дождитесь завершения процесса.

### Docker

Запуск всего приложения с базой данных одной командой:

```bash
docker-compose up -d
```

**Доступ к приложению:**

- API: http://localhost:3000
- Swagger: http://localhost:3000/api-docs
- Health: http://localhost:3000/health

**Что запускается:**

- MariaDB на порту `3307`
- Node.js приложение на порту `3000`
- Автоматическое создание БД и пользователя

**Управление:**

```bash
docker-compose down           # остановка
docker-compose up --build -d  # пересборка при изменениях
docker-compose logs -f app    # логи приложения
docker-compose logs -f db     # логи БД
```

## Тестирование

```bash
npm test                # все тесты
npm run test:validation # только валидация
npm run test:integration # с БД
```

Подробное руководство по тестированию в [TESTING.md](TESTING.md)

## REST API

### Системные

- `GET /` - информация об API
- `GET /health` - статус сервера
- `GET /api-docs` - Swagger документация

### Аутентификация

- `POST /auth/register` - регистрация пользователя
- `POST /auth/login` - вход (по username или email)
- `GET /auth/profile` - профиль пользователя (требует токен)

### Посты

- `GET /posts` - список всех постов (публичный, с пагинацией)
- `GET /posts/:id` - получить пост по ID (публичный)
- `POST /posts` - создать новый пост (требует авторизацию)
- `PUT /posts/:id` - редактировать пост (только автор)
- `DELETE /posts/:id` - удалить пост (только автор)

## Пагинация

Все списки поддерживают пагинацию:

```bash
GET /posts?page=1&limit=20
```

**Параметры:**

- `page` - номер страницы (по умолчанию: 1)
- `limit` - количество записей на странице (по умолчанию: 20, максимум: 100)

**Ответ:**

```json
{
  "data": [...],
  "meta": {
    "total": 150,
    "page": 1,
    "limit": 20,
    "totalPages": 8
  }
}
```

## Авторизация

Для защищенных роутов используйте JWT токен в заголовке:

```bash
Authorization: Bearer YOUR_JWT_TOKEN
```

## Роли и доступ

- **Неавторизованные:** могут просматривать посты
- **Авторизованные:** могут создавать и редактировать свои посты
- **Автор поста:** может редактировать и удалять только свои посты
