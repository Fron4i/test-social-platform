# Социальная платформа API

REST API для социальной платформы с авторизацией пользователей и постами.

## Технологии

- **Backend:** Node.js + Express.js + TypeScript
- **База данных:** MariaDB + TypeORM
- **Аутентификация:** JWT + bcrypt
- **Безопасность:** CORS, Helmet
- **Тестирование:** Jest + Supertest

## Архитектура

- **Контроллеры** - обработка HTTP запросов
- **Сущности** - User и Post с индексами для производительности
- **Middleware** - авторизация по JWT токенам
- **Валидация** - проверка входных данных
- **Связи** - User ↔ Posts (один-ко-многим)

## Запуск

### Docker

Запуск всего приложения с базой данных одной командой:

```bash
docker-compose up -d
```

**Что запускается:**

- MariaDB на порту `3307`
- Node.js приложение на порту `3000`
- Автоматическое создание БД и пользователя

**Управление:**

```bash
docker-compose down           # остановка
docker-compose up --build -d  # пересборка при изменениях
docker-compose logs -f app    # логи приложения
docker-compose logs -f db     # логи БД
```

**Доступ к приложению:**

- API: http://localhost:3000
- Swagger: http://localhost:3000/api-docs
- Health: http://localhost:3000/health

## Тестирование

```bash
npm test                # все тесты
npm run test:validation # только валидация
npm run test:integration # с БД
```

## REST API

### Системные

- `GET /` - информация об API
- `GET /health` - статус сервера
- `GET /api-docs` - Swagger документация

### Аутентификация

- `POST /auth/register` - регистрация пользователя
- `POST /auth/login` - вход (по username или email)
- `GET /auth/profile` - профиль пользователя (требует токен)

### Посты

- `GET /posts` - список всех постов (публичный, с пагинацией)
- `GET /posts/:id` - получить пост по ID (публичный)
- `POST /posts` - создать новый пост (требует авторизацию)
- `PUT /posts/:id` - редактировать пост (только автор)
- `DELETE /posts/:id` - удалить пост (только автор)

## Пагинация

Все списки поддерживают пагинацию:

```bash
GET /posts?page=1&limit=20
```

**Параметры:**

- `page` - номер страницы (по умолчанию: 1)
- `limit` - количество записей на странице (по умолчанию: 20, максимум: 100)

**Ответ:**

```json
{
  "data": [...],
  "meta": {
    "total": 150,
    "page": 1,
    "limit": 20,
    "totalPages": 8
  }
}
```

## Авторизация

Для защищенных роутов используйте JWT токен в заголовке:

```bash
Authorization: Bearer YOUR_JWT_TOKEN
```

## Роли и доступ

- **Неавторизованные:** могут просматривать посты
- **Авторизованные:** могут создавать и редактировать свои посты
- **Автор поста:** может редактировать и удалять только свои посты
